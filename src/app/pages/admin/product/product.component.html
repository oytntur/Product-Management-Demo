<div class="container-fluid py-4">
  @if (product$ | async; as product) {
  <div class="row">
    <!-- Product Header -->
    <div class="col-12 mb-4">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h1 class="card-title h3 mb-0">
            <i class="fas fa-box me-2"></i>
            {{ product.name }}
          </h1>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <div class="product-status mb-3">
                <span
                  class="badge fs-6"
                  [class]="product.discontinued ? 'bg-danger' : 'bg-success'"
                >
                  {{ product.discontinued ? 'Discontinued' : 'Active' }}
                </span>
              </div>
            </div>
            <div class="col-md-6 text-md-end">
              <h2 class="text-primary mb-0">${{ product.unitPrice }}</h2>
              <small class="text-muted">per {{ product.quantityPerUnit }}</small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Product Details -->
    <div class="col-lg-8 mb-4">
      <div class="card shadow-sm h-100">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="fas fa-info-circle me-2"></i>
            Product Details
          </h5>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-sm-6">
              <div class="detail-item">
                <label class="detail-label">Product ID</label>
                <div class="detail-value">{{ product.id }}</div>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="detail-item">
                <label class="detail-label">Supplier ID</label>
                <div class="detail-value">{{ product.supplierId }}</div>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="detail-item">
                <label class="detail-label">Category ID</label>
                <div class="detail-value">{{ product.categoryId }}</div>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="detail-item">
                <label class="detail-label">Quantity per Unit</label>
                <div class="detail-value">{{ product.quantityPerUnit }}</div>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="detail-item">
                <label class="detail-label">Unit Price</label>
                <div class="detail-value text-primary fw-bold">${{ product.unitPrice }}</div>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="detail-item">
                <label class="detail-label">Reorder Level</label>
                <div class="detail-value">{{ product.reorderLevel }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Inventory Status -->
    <div class="col-lg-4 mb-4">
      <div class="card shadow-sm h-100">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="fas fa-warehouse me-2"></i>
            Inventory Status
          </h5>
        </div>
        <div class="card-body">
          <div class="inventory-stats">
            <!-- Units in Stock with DevExtreme Progress Bar -->
            <div class="stat-item mb-3">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="stat-label">Units in Stock</span>
                <span
                  class="badge"
                  [class]="
                    product.unitsInStock <= product.reorderLevel
                      ? 'bg-warning text-dark'
                      : 'bg-success'
                  "
                >
                  {{ product.unitsInStock }}
                </span>
              </div>

              <dx-progress-bar
                [min]="0"
                [max]="(product.unitsInStock + product.reorderLevel) * 2"
                [value]="product.unitsOnOrder"
              ></dx-progress-bar>
            </div>

            <!-- Units on Order -->
            <div class="stat-item mb-3">
              <div class="d-flex justify-content-between align-items-center">
                <span class="stat-label">Units on Order</span>
                <span class="badge bg-info">{{ product.unitsOnOrder }}</span>
              </div>
            </div>

            <!-- Reorder Level Alert -->
            @if (product.unitsInStock <= product.reorderLevel) {
            <div class="alert alert-warning d-flex align-items-center">
              <i class="fas fa-exclamation-triangle me-2"></i>
              <div>
                <strong>Low Stock Alert!</strong><br />
                <small>Stock level is at or below reorder threshold.</small>
              </div>
            </div>
            }

            <!-- Total Available -->
            <div class="stat-summary">
              <div class="d-flex justify-content-between">
                <span class="fw-bold">Total Available:</span>
                <span class="fw-bold text-primary">{{
                  product.unitsInStock + product.unitsOnOrder
                }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions with DevExtreme Buttons -->
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="fas fa-tools me-2"></i>
            Quick Actions
          </h5>
        </div>
        <div class="card-body">
          <div class="d-flex flex-wrap gap-2">
            <dx-button
              text="Edit Product"
              type="normal"
              stylingMode="contained"
              icon="edit"
              [width]="140"
            ></dx-button>

            <dx-button
              text="Add Stock"
              type="success"
              stylingMode="contained"
              icon="plus"
              [width]="120"
            ></dx-button>

            <dx-button
              text="View Orders"
              type="default"
              stylingMode="outlined"
              icon="cart"
              [width]="130"
            ></dx-button>

            <dx-button
              text="Analytics"
              type="default"
              stylingMode="outlined"
              icon="chart"
              [width]="110"
            ></dx-button>

            <dx-button
              [text]="product.discontinued ? 'Reactivate' : 'Discontinue'"
              [type]="product.discontinued ? 'success' : 'danger'"
              stylingMode="outlined"
              [icon]="product.discontinued ? 'activefolder' : 'remove'"
              [width]="130"
            ></dx-button>
          </div>
        </div>
      </div>
    </div>
  </div>
  } @else {
  <!-- Loading and No Product States -->
  @if ((product$ | async) === null) {
  <!-- No Product Template -->
  <div class="row">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-body text-center py-5">
          <i class="fas fa-box-open fa-3x text-muted mb-3"></i>
          <h4 class="text-muted">No Product Selected</h4>
          <p class="text-muted">Please select a product to view its details.</p>
          <dx-button
            text="Browse Products"
            type="default"
            stylingMode="contained"
            icon="bulletlist"
          ></dx-button>
        </div>
      </div>
    </div>
  </div>
  } @else {
  <!-- Loading Template with DevExtreme LoadIndicator -->
  <div class="row">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-body text-center py-5">
          <dx-load-indicator [visible]="true" [height]="60" [width]="60"></dx-load-indicator>
          <p class="mt-3 text-muted">Loading product details...</p>
        </div>
      </div>
    </div>
  </div>
  } }
</div>
