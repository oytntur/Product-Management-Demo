<!-- TODO: Update the form with DevExtreme components later -->
<form [formGroup]="form" (ngSubmit)="submit()" class="space-y-6">
  <fieldset formGroupName="product" class="border p-4 rounded">
    <legend>Product</legend>

    <div class="grid" style="grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 12px">
      <label>
        <div>Name *</div>
        <input formControlName="name" />
      </label>

      <label>
        <div>Quantity Per Unit *</div>
        <input formControlName="quantityPerUnit" />
      </label>

      <label>
        <div>Unit Price *</div>
        <input type="number" formControlName="unitPrice" />
      </label>

      <label>
        <div>Units In Stock</div>
        <input type="number" formControlName="unitsInStock" />
      </label>

      <label>
        <div>Units On Order</div>
        <input type="number" formControlName="unitsOnOrder" />
      </label>

      <label>
        <div>Reorder Level</div>
        <input type="number" formControlName="reorderLevel" />
      </label>

      <label style="grid-column: span 2 / span 2">
        <input type="checkbox" formControlName="discontinued" />
        <span style="margin-left: 8px">Discontinued</span>
      </label>
    </div>
  </fieldset>

  <section class="border p-4 rounded">
    <div class="flex items-center justify-between">
      <legend>Orders (optional)</legend>
      <button type="button" (click)="addOrder()">Add Order</button>
    </div>

    <div formArrayName="orders" class="space-y-4">
      <div
        *ngFor="let orderFG of ordersFA.controls; let i = index"
        [formGroupName]="i"
        class="border rounded p-3"
      >
        <div class="flex items-center justify-between">
          <h4>Order #{{ i + 1 }}</h4>
          <button type="button" (click)="removeOrder(i)">Remove</button>
        </div>

        <div class="grid" style="grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 12px">
          <label>
            <div>Customer Id</div>
            <input formControlName="customerId" />
          </label>

          <label>
            <div>Employee Id</div>
            <input type="number" formControlName="employeeId" />
          </label>

          <label>
            <div>Order Date</div>
            <input type="date" formControlName="orderDate" />
          </label>

          <label>
            <div>Required Date</div>
            <input type="date" formControlName="requiredDate" />
          </label>

          <label>
            <div>Shipped Date</div>
            <input type="date" formControlName="shippedDate" />
          </label>

          <label>
            <div>Ship Via</div>
            <input type="number" formControlName="shipVia" />
          </label>

          <label>
            <div>Freight</div>
            <input type="number" formControlName="freight" />
          </label>

          <label>
            <div>Ship Name</div>
            <input formControlName="shipName" />
          </label>
        </div>

        <fieldset formGroupName="shipAddress" class="border p-3 rounded mt-3">
          <legend>Ship Address</legend>
          <div class="grid" style="grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 12px">
            <label>
              <div>Street</div>
              <input formControlName="street" />
            </label>
            <label>
              <div>City</div>
              <input formControlName="city" />
            </label>
            <label>
              <div>Region</div>
              <input formControlName="region" />
            </label>
            <label>
              <div>Postal Code</div>
              <input type="number" formControlName="postalCode" />
            </label>
            <label>
              <div>Country</div>
              <input formControlName="country" />
            </label>
          </div>
        </fieldset>

        <div class="mt-3 border rounded p-3">
          <div class="flex items-center justify-between">
            <h5>Details</h5>
            <button type="button" (click)="addDetail(i)">Add Detail</button>
          </div>

          <div formArrayName="details" class="space-y-2 mt-2">
            <div
              *ngFor="let d of getDetailsFA(i).controls; let j = index"
              [formGroupName]="j"
              class="grid"
              style="grid-template-columns: repeat(4, minmax(0, 1fr)); gap: 8px"
            >
              <input placeholder="Product Id" formControlName="productId" />
              <input type="number" placeholder="Unit Price" formControlName="unitPrice" />
              <input type="number" placeholder="Quantity" formControlName="quantity" />
              <input type="number" placeholder="Discount (0-1)" formControlName="discount" />
              <div style="grid-column: 1 / -1; text-align: right">
                <button type="button" (click)="removeDetail(i, j)">Remove Detail</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="flex gap-3">
    <button type="submit">{{ isEdit() ? 'Update' : 'Create' }}</button>
  </div>
</form>
