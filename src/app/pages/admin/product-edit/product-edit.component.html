<div class="container py-4">
  <div class="d-flex flex-wrap justify-content-between align-items-start gap-3 mb-4">
    <div>
      <h1 class="h3 mb-1">{{ pageTitle() }}</h1>
      <p class="text-muted mb-0">{{ pageSubtitle() }}</p>
    </div>
    @if (!isCreateMode() && product(); as currentProduct) {
    <span class="badge bg-primary align-self-center">ID #{{ currentProduct.id }}</span>
    }
  </div>

  @if (errorMessage(); as error) {
  <div class="alert alert-danger" role="alert">{{ error }}</div>
  }

  @if (successMessage(); as success) {
  <div class="alert alert-success" role="alert">{{ success }}</div>
  }

  @if (isLoading()) {
  <div class="card shadow-sm">
    <div class="card-body text-center py-5">
      <div class="spinner-border text-primary" role="status"></div>
      <p class="mt-3 text-muted mb-0">Ürün bilgileri yükleniyor...</p>
    </div>
  </div>
  } @else {
  <form [formGroup]="productForm" (ngSubmit)="submit()" class="card shadow-sm">
    <div class="card-body">
      <div class="row g-3">
        <div class="col-lg-6">
          <label class="form-label">Ürün Adı</label>
          <input
            type="text"
            class="form-control"
            formControlName="name"
            placeholder="Ürün adı"
            [class.is-invalid]="productForm.controls.name.invalid && (productForm.controls.name.dirty || productForm.controls.name.touched)"
          />
          @if (productForm.controls.name.invalid && (productForm.controls.name.dirty || productForm.controls.name.touched)) {
          <div class="invalid-feedback">Ürün adı zorunludur.</div>
          }
        </div>

        <div class="col-lg-3 col-md-6">
          <label class="form-label">Birim Fiyat</label>
          <input
            type="number"
            min="0"
            step="0.01"
            class="form-control"
            formControlName="unitPrice"
            placeholder="0,00"
            [class.is-invalid]="productForm.controls.unitPrice.invalid && (productForm.controls.unitPrice.dirty || productForm.controls.unitPrice.touched)"
          />
          @if (productForm.controls.unitPrice.invalid && (productForm.controls.unitPrice.dirty || productForm.controls.unitPrice.touched)) {
          <div class="invalid-feedback">Birim fiyatı 0 veya daha büyük olmalıdır.</div>
          }
        </div>

        <div class="col-lg-3 col-md-6">
          <label class="form-label">Stoktaki Ürün</label>
          <input
            type="number"
            min="0"
            step="1"
            class="form-control"
            formControlName="unitsInStock"
            placeholder="0"
            [class.is-invalid]="productForm.controls.unitsInStock.invalid && (productForm.controls.unitsInStock.dirty || productForm.controls.unitsInStock.touched)"
          />
          @if (productForm.controls.unitsInStock.invalid && (productForm.controls.unitsInStock.dirty || productForm.controls.unitsInStock.touched)) {
          <div class="invalid-feedback">Stok bilgisi 0 veya daha büyük olmalıdır.</div>
          }
        </div>

        <div class="col-md-4 col-lg-3">
          <label class="form-label">Birim</label>
          <select class="form-select" formControlName="unit">
            @for (unitOption of unitOptions; track unitOption) {
            <option [value]="unitOption">{{ unitOption }}</option>
            }
          </select>
        </div>

        <div class="col-md-4 col-lg-3 align-self-end">
          <div class="form-check">
            <input type="checkbox" class="form-check-input" id="discontinued" formControlName="discontinued" />
            <label class="form-check-label" for="discontinued">Satıştan kaldırıldı</label>
          </div>
        </div>
      </div>
    </div>

    <div class="card-footer d-flex flex-wrap justify-content-end gap-2">
      <button type="button" class="btn btn-outline-secondary" (click)="navigateBack()">Vazgeç</button>
      <button type="button" class="btn btn-outline-info" (click)="restoreForm()">Değişiklikleri Geri Al</button>
      <button type="submit" class="btn btn-primary" [disabled]="!canSubmit()">
        <span class="spinner-border spinner-border-sm me-2" role="status" *ngIf="isSubmitting()"></span>
        {{ submitLabel() }}
      </button>
    </div>
  </form>

  @if (!isCreateMode()) {
  <div class="card shadow-sm mt-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h2 class="h6 mb-0">Ürüne Bağlı Siparişler</h2>
      <span class="badge bg-light text-dark">{{ orders().length }} kayıt</span>
    </div>
    <div class="card-body p-0">
      @if (hasOrders()) {
      <div class="table-responsive">
        <table class="table table-striped mb-0 align-middle">
          <thead class="table-light">
            <tr>
              <th scope="col">Sipariş ID</th>
              <th scope="col">Müşteri</th>
              <th scope="col">Sipariş Tarihi</th>
              <th scope="col">Teslim Tarihi</th>
              <th scope="col" class="text-end">Miktar</th>
            </tr>
          </thead>
          <tbody>
            @for (order of orders(); track order.id) {
            <tr>
              <td>#{{ order.id }}</td>
              <td>{{ order.customerName }}</td>
              <td>{{ order.orderDate | date : 'mediumDate' }}</td>
              <td>{{ order.expectedDeliveryDate | date : 'mediumDate' }}</td>
              <td class="text-end">{{ order.amount | number : '1.0-0' }}</td>
            </tr>
            }
          </tbody>
        </table>
      </div>
      } @else {
      <div class="py-4 text-center text-muted">
        <p class="mb-0">Bu ürüne ait sipariş bulunmuyor.</p>
      </div>
      }
    </div>
  </div>
  }
  }
</div>
